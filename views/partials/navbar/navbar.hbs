<div class='header'>
  {{#if currentUser.channelName}}
  <div class='search-bar'>
    <form class="search" role='search' method='POST' action='/search'>
      <div class="search-wrapper">
        <input type='text' name='search' placeholder='Search' />
        <a id="filter-btn"> <img id="filter-img" width="20" src="/images/icons/arrow-down.png"> </img> </a>
      </div>
      <div class="search-filters">
        <div>
          <input type="checkbox" id="search-title" name="titleFilter">
          <label for="search-title">Title</label>
        </div>
        <div>
          <input type="checkbox" id="search-author" name="authorFilter">
          <label for="search-author">Author</label>
        </div>
        <div>
          <input type="checkbox" id="search-category" name="categoryFilter">
          <label for="search-category">Category</label>
        </div>
        <div>
          <input type="checkbox" id="search-tags" name="tagsFilter">
          <label for="search-tags">Tags</label>
        </div>
        <div>
          <input type="checkbox" id="search-all" name="allFilter">
          <label for="search-all">All</label>
        </div>
      </div>
    </form>
  </div>
  <div class='user-settings'>
        <a href="/profile">
          <img class='user-img' src={{currentUser.profilePic}} alt='profile-pic' />
        </a>      
    <div class="btn-group">
      <button type="button" class="btn dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
        {{currentUser.channelName}}      
      </button>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="/profile"> <img src="/images/png/profile.png" alt="profile-pic"> My Channel</a></li>
        <li><a class="dropdown-item" href="/profile/{{currentUser._id}}/accountSettings"><img src="/images/png/settings.png" alt="settings"> Settings</a></li>
        <li><a class="dropdown-item" href="/logout"><img src="/images/png/logout.png" alt="logout"> Logout</a></li>
      </ul>
    </div>
    <div class="notify btn-group">
      <div id="notiAnim"></div> 
      <button type="button" class="btn dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
        <svg viewBox='0 0 24 24' fill='currentColor'>
          <path fill-rule='evenodd' clip-rule='evenodd'
            d='M18.707 8.796c0 1.256.332 1.997 1.063 2.85.553.628.73 1.435.73 2.31 0 .874-.287 1.704-.863 2.378a4.537 4.537 0 01-2.9 1.413c-1.571.134-3.143.247-4.736.247-1.595 0-3.166-.068-4.737-.247a4.532 4.532 0 01-2.9-1.413 3.616 3.616 0 01-.864-2.378c0-.875.178-1.682.73-2.31.754-.854 1.064-1.594 1.064-2.85V8.37c0-1.682.42-2.781 1.283-3.858C7.861 2.942 9.919 2 11.956 2h.09c2.08 0 4.204.987 5.466 2.625.82 1.054 1.195 2.108 1.195 3.745v.426zM9.074 20.061c0-.504.462-.734.89-.833.5-.106 3.545-.106 4.045 0 .428.099.89.33.89.833-.025.48-.306.904-.695 1.174a3.635 3.635 0 01-1.713.731 3.795 3.795 0 01-1.008 0 3.618 3.618 0 01-1.714-.732c-.39-.269-.67-.694-.695-1.173z'>
          </path>
        </svg>      
      </button>
      <div class="dropdown-menu" id="dropDiv">
      </ul>
      </div>
    </div>


      


  </div>
  {{else}}
  <div class='search-bar'>
    <form role='search' method='POST' action='/search'>
 <div class="search-wrapper">
        <input type='text' name='search' placeholder='Search' />
      </div> 
     </form>
  </div>

  
  <div class='user-settings'>
    <div class="button-wrapper" style="">
      <a class="like" href="/login">
        <img src="/images/png/login.png" width="30%" style="margin-right:5px">
        Login
      </a>
    </div>

  </div>
  {{/if}}
</div>

<script>

  let filterBtn = document.getElementById('filter-btn')
  let filtersDiv = document.querySelector('.search-filters')


  window.addEventListener('DOMContentLoaded', (event) => {
    
    setInterval(updateNotification, 5000)

    filterBtn.addEventListener('click', () => {
      if (filtersDiv.style.display == 'none') {
        filtersDiv.style.display = 'flex'
        document.getElementById('filter-img').src = '../../images/icons/arrow-up.png'
    } else {
        filtersDiv.style.display = 'none'
        document.getElementById('filter-img').src =
        '../../images/icons/arrow-down.png'
      }
    })
  })

  const updateNotification = () => {
    axios
      .get(`/notification`, { headers: { 'Content-Type': 'application/json' } })
      .then((response) => {
        let dropDiv = document.getElementById('dropDiv')
        let notiAnim = document.getElementById('notiAnim')
        dropDiv.innerHTML = ''

        if (response.data.length > 0) {
          notiAnim.classList.add('notification')
        }

        let notifList = document.createElement('ul')
        response.data.forEach((user) => {
          let notifListItem = document.createElement('li')
          let aTag = document.createElement('a')
          aTag.setAttribute('href', `/messages/${user.sender._id}`)
          aTag.classList.add('dropdown-item')
          let textNode = document.createTextNode(user.sender.username)
          aTag.appendChild(textNode)
          notifListItem.appendChild(aTag)
          dropDiv.appendChild(notifListItem)
        })
      })
      .catch(function (error) {
        console.log('ERROR', error)
      })

    return true
  }

</script>